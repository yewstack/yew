---
title: 'wasm-bindgen'
sidebar_label: wasm-bindgen
---

[`wasm-bindgen`](https://github.com/rustwasm/wasm-bindgen) ã¯ã€JavaScript ã¨ Rust é–¢æ•°ã®é–“ã«å‘¼ã³å‡ºã—ãƒ–ãƒªãƒƒã‚¸ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŠã‚ˆã³ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã“ã‚Œã¯ [Rust ã¨ WebAssembly ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ã‚°ãƒ«ãƒ¼ãƒ—](https://rustwasm.github.io/) ã«ã‚ˆã£ã¦ Rust ã§æ§‹ç¯‰ã•ã‚Œã¾ã—ãŸã€‚

Yew ã¯ `wasm-bindgen` ã‚’ä½¿ç”¨ã—ã¦ã€ã„ãã¤ã‹ã®ã‚¯ãƒ¬ãƒ¼ãƒˆã‚’ä»‹ã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã¨å¯¾è©±ã—ã¾ã™ï¼š

- [`js-sys`](https://crates.io/crates/js-sys)
- [`wasm-bindgen`](https://crates.io/crates/wasm-bindgen)
- [`wasm-bindgen-futures`](https://crates.io/crates/wasm-bindgen-futures)
- [`web-sys`](https://crates.io/crates/web-sys)

ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ã“ã‚Œã‚‰ã®ã‚¯ãƒ¬ãƒ¼ãƒˆã‚’ã‚ˆã‚ŠæŠ½è±¡çš„ãªãƒ¬ãƒ™ãƒ«ã‹ã‚‰æ¢æ±‚ã—ã€Yew ã§ã® `wasm-bindgen` API ã®ç†è§£ã¨ä½¿ç”¨ã‚’å®¹æ˜“ã«ã—ã¾ã™ã€‚`wasm-bindgen` ãŠã‚ˆã³é–¢é€£ã™ã‚‹ã‚¯ãƒ¬ãƒ¼ãƒˆã«é–¢ã™ã‚‹è©³ç´°ãªã‚¬ã‚¤ãƒ‰ã«ã¤ã„ã¦ã¯ã€[`wasm-bindgen` ã‚¬ã‚¤ãƒ‰](https://wasm-bindgen.github.io/wasm-bindgen/) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ä¸Šè¨˜ã®ã‚¯ãƒ¬ãƒ¼ãƒˆã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¤ã„ã¦ã¯ã€[`wasm-bindgen docs.rs`](https://rustwasm.github.io/wasm-bindgen/api/wasm_bindgen/index.html) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

:::tip
`wasm-bindgen` doc.rs æ¤œç´¢ã‚’ä½¿ç”¨ã—ã¦ã€`wasm-bindgen` ã‚’ä½¿ç”¨ã—ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸãƒ–ãƒ©ã‚¦ã‚¶ API ãŠã‚ˆã³ JavaScript ã‚¿ã‚¤ãƒ—ã‚’è¦‹ã¤ã‘ã¾ã™ã€‚
:::

## [`wasm-bindgen`](https://crates.io/crates/wasm-bindgen)

ã“ã®ã‚¯ãƒ¬ãƒ¼ãƒˆã¯ã€ä¸Šè¨˜ã®ä»–ã®ã‚¯ãƒ¬ãƒ¼ãƒˆã«å¤šãã®æ§‹æˆè¦ç´ ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€`wasm-bindgen` ã‚¯ãƒ¬ãƒ¼ãƒˆã®ä¸»è¦ãªé ˜åŸŸã® 2 ã¤ã€ã¤ã¾ã‚Šãƒã‚¯ãƒ­ã¨ã€ä½•åº¦ã‚‚ç›®ã«ã™ã‚‹ã‚¿ã‚¤ãƒ—/ãƒˆãƒ¬ã‚¤ãƒˆã®ã„ãã¤ã‹ã«ã¤ã„ã¦ã®ã¿èª¬æ˜ã—ã¾ã™ã€‚

### `#[wasm_bindgen]` ãƒã‚¯ãƒ­

`#[wasm_bindgen]` ãƒã‚¯ãƒ­ã¯ Rust ã¨ JavaScript ã®é–“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã—ã€ä¸¡è€…ã®é–“ã§å¤‰æ›ã‚’è¡Œã†ã‚·ã‚¹ãƒ†ãƒ ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã®ãƒã‚¯ãƒ­ã®ä½¿ç”¨ã¯ã‚ˆã‚Šé«˜åº¦ã§ã‚ã‚Šã€å¤–éƒ¨ã® JavaScript ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã‚’é™¤ã„ã¦ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„ã€‚`js-sys` ãŠã‚ˆã³ `web-sys` ã‚¯ãƒ¬ãƒ¼ãƒˆã¯ã€çµ„ã¿è¾¼ã¿ã® JavaScript ã‚¿ã‚¤ãƒ—ãŠã‚ˆã³ãƒ–ãƒ©ã‚¦ã‚¶ API ã«å¯¾ã—ã¦ `wasm-bindgen` å®šç¾©ã‚’æä¾›ã—ã¾ã™ã€‚

`#[wasm-bindgen]` ãƒã‚¯ãƒ­ã‚’ä½¿ç”¨ã—ã¦ã€ç‰¹å®šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® [`console.log`](https://developer.mozilla.org/en-US/docs/Web/API/Console/log) é–¢æ•°ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ç°¡å˜ãªä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```rust ,no_run
use wasm_bindgen::prelude::*;

// ã¾ãšã€`web_sys` ã‚’ä½¿ç”¨ã›ãšã« `console.log` ã‚’æ‰‹å‹•ã§ãƒã‚¤ãƒ³ãƒ‰ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
// ã“ã“ã§ã¯ã€æ‰‹å‹•ã§ `#[wasm_bindgen]` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ›¸ãã¾ã™ã€‚ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æ­£ç¢ºæ€§ã¯ã“ã‚Œã‚‰ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®æ­£ç¢ºæ€§ã«ä¾å­˜ã—ã¾ã™ï¼
#[wasm_bindgen]
extern "C" {
    // ã“ã“ã§ `js_namespace` ã‚’ä½¿ç”¨ã—ã¦ `console.log(..)` ã‚’ãƒã‚¤ãƒ³ãƒ‰ã—ã¾ã™ã€‚`log(..)` ã ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
    #[wasm_bindgen(js_namespace = console)]
    fn log(s: &str);

    // `console.log` ã¯å¤šæ…‹çš„ãªã®ã§ã€è¤‡æ•°ã®ã‚·ã‚°ãƒãƒãƒ£ã‚’ä½¿ç”¨ã—ã¦ãƒã‚¤ãƒ³ãƒ‰ã§ãã¾ã™ã€‚
    #[wasm_bindgen(js_namespace = console, js_name = log)]
    fn log_u32(a: u32);

    // è¤‡æ•°ã®å¼•æ•°ã‚‚å¯èƒ½ã§ã™ï¼
    #[wasm_bindgen(js_namespace = console, js_name = log)]
    fn log_many(a: &str, b: &str);
}

// ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸé–¢æ•°ã‚’ä½¿ç”¨ã—ã¾ã™ï¼
log("Hello from Rust!");
log_u32(42);
log_many("Logging", "many values!");
```

_ã“ã®ä¾‹ã¯ã€[1.2 `wasm-bindgen` ã‚¬ã‚¤ãƒ‰ã® console.log ã‚’ä½¿ç”¨ã™ã‚‹](https://wasm-bindgen.github.io/wasm-bindgen/examples/console-log.html) ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚_

### ç¶™æ‰¿ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

JavaScript ã‚¯ãƒ©ã‚¹é–“ã®ç¶™æ‰¿ã¯ã€JavaScript è¨€èªã®ã‚³ã‚¢æ©Ÿèƒ½ã§ã‚ã‚Šã€DOMï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ‡ãƒ«ï¼‰ã¯ãã‚Œã‚’ä¸­å¿ƒã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚`wasm-bindgen` ã‚’ä½¿ç”¨ã—ã¦å‹ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹éš›ã«ã‚‚ã€ãã‚Œã‚‰ã®ç¶™æ‰¿é–¢ä¿‚ã‚’è¨˜è¿°ã™ã‚‹å±æ€§ã‚’è¿½åŠ ã§ãã¾ã™ã€‚

Rust ã§ã¯ã€ã“ã®ç¶™æ‰¿é–¢ä¿‚ã¯ [`Deref`](https://doc.rust-lang.org/std/ops/trait.Deref.html) ã¨ [`AsRef`](https://doc.rust-lang.org/std/convert/trait.AsRef.html) ãƒˆãƒ¬ã‚¤ãƒˆã‚’ä½¿ç”¨ã—ã¦è¡¨ç¾ã•ã‚Œã¾ã™ã€‚ã“ã“ã§ä¾‹ã‚’æŒ™ã’ã‚‹ã¨å½¹ç«‹ã¤ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ä¾‹ãˆã°ã€`A`ã€`B`ã€`C` ã¨ã„ã† 3 ã¤ã®å‹ãŒã‚ã‚Šã€`C` ãŒ `B` ã‚’æ‹¡å¼µã—ã€`B` ãŒ `A` ã‚’æ‹¡å¼µã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®å‹ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹éš›ã€`#[wasm-bindgen]` ãƒã‚¯ãƒ­ã¯æ¬¡ã®ã‚ˆã†ã« `Deref` ã¨ `AsRef` ãƒˆãƒ¬ã‚¤ãƒˆã‚’å®Ÿè£…ã—ã¾ã™ï¼š

- `C` ã¯ `B` ã« `Deref` ã§ãã¾ã™
- `B` ã¯ `A` ã« `Deref` ã§ãã¾ã™
- `C` ã¯ `B` ã« `AsRef` ã§ãã¾ã™
- `C` ã¨ `B` ã¯ã©ã¡ã‚‰ã‚‚ `A` ã« `AsRef` ã§ãã¾ã™

ã“ã‚Œã‚‰ã®å®Ÿè£…ã«ã‚ˆã‚Šã€`C` ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ `A` ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ãŸã‚Šã€`C` ã‚’ `&B` ã¾ãŸã¯ `&A` ã¨ã—ã¦ä½¿ç”¨ã—ãŸã‚Šã§ãã¾ã™ã€‚

æ³¨æ„ã™ã¹ãç‚¹ã¯ã€`#[wasm-bindgen]` ã‚’ä½¿ç”¨ã—ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸã™ã¹ã¦ã®å‹ã«ã¯åŒã˜ãƒ«ãƒ¼ãƒˆå‹ãŒã‚ã‚Šã€ãã‚Œã‚’ä¸Šè¨˜ã®ä¾‹ã® `A` ã¨è¦‹ãªã™ã“ã¨ãŒã§ãã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚ã“ã®å‹ã¯ [`JsValue`](#jsvalue) ã§ã‚ã‚Šã€ä»¥ä¸‹ã«ãã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚

_[`wasm-bindgen` ã‚¬ã‚¤ãƒ‰ã® extends ã‚»ã‚¯ã‚·ãƒ§ãƒ³](https://wasm-bindgen.github.io/wasm-bindgen/reference/attributes/on-js-imports/extends.html)_

### [`JsValue`](https://rustwasm.github.io/wasm-bindgen/api/wasm_bindgen/struct.JsValue.html)

ã“ã‚Œã¯ JavaScript ãŒæ‰€æœ‰ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¡¨ç¾ã§ã‚ã‚Šã€`wasm-bindgen` ã®ãƒ«ãƒ¼ãƒˆã‚­ãƒ£ãƒ—ãƒãƒ£å‹ã§ã™ã€‚`wasm-bindgen` ã‹ã‚‰ã®ä»»æ„ã®å‹ã¯ `JsValue` ã§ã™ã€‚ã“ã‚Œã¯ã€JavaScript ã«ã¯å¼·ã„å‹ã‚·ã‚¹ãƒ†ãƒ ãŒãªã„ãŸã‚ã€å¤‰æ•° `x` ã‚’å—ã‘å–ã‚‹ä»»æ„ã®é–¢æ•°ãŒãã®å‹ã‚’å®šç¾©ã—ãªã„ãŸã‚ã€`x` ã¯æœ‰åŠ¹ãª JavaScript å€¤ã§ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚ã—ãŸãŒã£ã¦ `JsValue` ã§ã™ã€‚`JsValue` ã‚’å—ã‘å–ã‚‹ã‚¤ãƒ³ãƒãƒ¼ãƒˆé–¢æ•°ã‚„å‹ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€æŠ€è¡“çš„ã«ã¯ä»»æ„ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆå€¤ãŒæœ‰åŠ¹ã§ã™ã€‚

`JsValue` ã¯é–¢æ•°ã§å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€ãã®é–¢æ•°ã¯ç‰¹å®šã®å‹ã®ã¿ã‚’å—ã‘å–ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€ãã‚ŒãŒãƒ‘ãƒ‹ãƒƒã‚¯ã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€å…ƒã® `wasm-bindgen` API ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸ JavaScript ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ã¦ã€ãã®å€¤ãŒç‰¹å®šã®å‹ã§ãªã„å ´åˆã«ä¾‹å¤–ï¼ˆãƒ‘ãƒ‹ãƒƒã‚¯ï¼‰ã‚’å¼•ãèµ·ã“ã™ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

_[`JsValue` ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://rustwasm.github.io/wasm-bindgen/api/wasm_bindgen/struct.JsValue.html)_

### [`JsCast`](https://rustwasm.github.io/wasm-bindgen/api/wasm_bindgen/trait.JsCast.html)

Rust ã«ã¯å¼·ã„å‹ã‚·ã‚¹ãƒ†ãƒ ãŒã‚ã‚Šã¾ã™ãŒã€JavaScript ã«ã¯ã‚ã‚Šã¾ã›ã‚“ğŸ˜ã€‚Rust ãŒã“ã‚Œã‚‰ã®å¼·ã„å‹ã‚’ç¶­æŒã—ãªãŒã‚‰ã‚‚ä¾¿åˆ©ã§ã‚ã‚‹ãŸã‚ã«ã€WebAssembly ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ã‚°ãƒ«ãƒ¼ãƒ—ã¯éå¸¸ã«å·§å¦™ãªæ©Ÿèƒ½ `JsCast` ã‚’ææ¡ˆã—ã¾ã—ãŸã€‚ã“ã‚Œã¯ã€ã‚ã‚‹ JavaScript "å‹" ã‹ã‚‰åˆ¥ã® "å‹" ã¸ã®å¤‰æ›ã‚’æ”¯æ´ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ã“ã‚Œã¯æ›–æ˜§ã«èã“ãˆã¾ã™ãŒã€ã‚ã‚‹å‹ãŒåˆ¥ã®å‹ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã£ã¦ã„ã‚‹å ´åˆã€`JsCast` ã®é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ã‚ã‚‹å‹ã‹ã‚‰åˆ¥ã®å‹ã«ã‚¸ãƒ£ãƒ³ãƒ—ã§ãã¾ã™ã€‚`web-sys`ã€`wasm_bindgen`ã€`js-sys` ã‚’ä½¿ç”¨ã™ã‚‹éš›ã«ã“ã®æ©Ÿèƒ½ã‚’ç†è§£ã—ã¦ãŠãã¨ä¾¿åˆ©ã§ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¯ãƒ¬ãƒ¼ãƒˆã‹ã‚‰å¤šãã®å‹ãŒ `JsCast` ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã“ã¨ã«æ°—ä»˜ãã§ã—ã‚‡ã†ã€‚

`JsCast` ã¯ãƒã‚§ãƒƒã‚¯ä»˜ãã¨ãƒã‚§ãƒƒã‚¯ãªã—ã®å¤‰æ›ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã—ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€å®Ÿè¡Œæ™‚ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã©ã®å‹ã§ã‚ã‚‹ã‹ã‚ã‹ã‚‰ãªã„å ´åˆã¯ã€å¤‰æ›ã‚’è©¦ã¿ã‚‹ã“ã¨ãŒã§ãã€å¤±æ•—ã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹å‹ã¨ã—ã¦ [`Option`](https://doc.rust-lang.org/std/option/enum.Option.html) ã‚„ [`Result`](https://doc.rust-lang.org/std/result/enum.Result.html) ã‚’è¿”ã—ã¾ã™ã€‚

ä¸€èˆ¬çš„ãªä¾‹ã¯ [`web-sys`](./web-sys.mdx) ã§ã€ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’å–å¾—ã—ã‚ˆã†ã¨ã™ã‚‹å ´åˆã§ã™ã€‚ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¦ç´ ãŒä½•ã§ã‚ã‚‹ã‹ã‚’çŸ¥ã£ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€[`web_sys::Event`](https://rustwasm.github.io/wasm-bindgen/api/web_sys/struct.Event.html) API ã¯å¸¸ã« [`Option<web_sys::EventTarget>`](https://rustwasm.github.io/wasm-bindgen/api/web_sys/struct.Event.html#method.target) ã‚’è¿”ã—ã¾ã™ã€‚
ãã®è¦ç´ å‹ã«å¤‰æ›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ãã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚

```rust
// ã“ã®ãƒˆãƒ¬ã‚¤ãƒˆã‚’æœ€åˆã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
use wasm_bindgen::JsCast;
use web_sys::{Event, EventTarget, HtmlInputElement, HtmlSelectElement};

fn handle_event(event: Event) {
    let target: EventTarget = event
        .target()
        .expect("I'm sure this event has a target!");

    // ã‚‚ã—ã‹ã—ãŸã‚‰ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¯é¸æŠè¦ç´ ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã‹ï¼Ÿ
    if let Some(select_element) = target.dyn_ref::<HtmlSelectElement>() {
        // åˆ¥ã®ã“ã¨ã‚’ã™ã‚‹
        return;
    }

    // ãã‚ŒãŒé¸æŠè¦ç´ ã§ãªã„ã“ã¨ãŒç¢ºå®Ÿã§ã‚ã‚Œã°ã€å…¥åŠ›è¦ç´ ã§ã‚ã‚‹ã“ã¨ãŒç¢ºå®Ÿã§ã™ï¼
    let input_element: HtmlInputElement = target.unchecked_into();
}
```

[`dyn_ref`](https://rustwasm.github.io/wasm-bindgen/api/wasm_bindgen/trait.JsCast.html#method.dyn_ref) ãƒ¡ã‚½ãƒƒãƒ‰ã¯ãƒã‚§ãƒƒã‚¯ä»˜ãã®å¤‰æ›ã§ã‚ã‚Šã€`Option<&T>` ã‚’è¿”ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€å¤‰æ›ãŒå¤±æ•—ã—ãŸå ´åˆã«å…ƒã®å‹ã‚’å†åº¦ä½¿ç”¨ã§ãã‚‹ã“ã¨ã‚’æ„å‘³ã—ã€`None` ã‚’è¿”ã—ã¾ã™ã€‚ [`dyn_into`](https://rustwasm.github.io/wasm-bindgen/api/wasm_bindgen/trait.JsCast.html#method.dyn_into) ãƒ¡ã‚½ãƒƒãƒ‰ã¯ `self` ã‚’æ¶ˆè²»ã—ã€Rust ã® `into` ãƒ¡ã‚½ãƒƒãƒ‰ã®è¦ç´„ã«å¾“ã„ã€`Result<T, Self>` å‹ã‚’è¿”ã—ã¾ã™ã€‚å¤‰æ›ãŒå¤±æ•—ã—ãŸå ´åˆã€å…ƒã® `Self` å€¤ã¯ `Err` ã«è¿”ã•ã‚Œã¾ã™ã€‚å†è©¦è¡Œã™ã‚‹ã‹ã€å…ƒã®å‹ã§ä»–ã®æ“ä½œã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

_[`JsCast` ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://rustwasm.github.io/wasm-bindgen/api/wasm_bindgen/trait.JsCast.html)._

### [`Closure`](https://rustwasm.github.io/wasm-bindgen/api/wasm_bindgen/closure/struct.Closure.html)

`Closure` å‹ã¯ã€Rust ã®ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã‚’ JavaScript ã«æ¸¡ã™æ–¹æ³•ã‚’æä¾›ã—ã¾ã™ã€‚å¥å…¨æ€§ã®ç†ç”±ã‹ã‚‰ã€JavaScript ã«æ¸¡ã•ã‚Œã‚‹ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã¯ `'static` ãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ ã‚’æŒã¤å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®å‹ã¯ã€Œãƒãƒ³ãƒ‰ãƒ«ã€ã§ã‚ã‚Šã€ç ´æ£„ã•ã‚Œã‚‹ã¨ã€ãã‚ŒãŒå‚ç…§ã™ã‚‹ JS ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã‚’ç„¡åŠ¹ã«ã—ã¾ã™ã€‚`Closure` ãŒç ´æ£„ã•ã‚ŒãŸå¾Œã€JS å†…ã®ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã®ä½¿ç”¨ã¯ã™ã¹ã¦ä¾‹å¤–ã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚

`Closure` ã¯ã€[`&js_sys::Function`](https://rustwasm.github.io/wasm-bindgen/api/js_sys/struct.Function.html) å‹ã‚’å—ã‘å–ã‚‹ `js-sys` ã¾ãŸã¯ `web-sys` API ã‚’ä½¿ç”¨ã™ã‚‹éš›ã«ä¸€èˆ¬çš„ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚Yew ã§ `Closure` ã‚’ä½¿ç”¨ã™ã‚‹ä¾‹ã¯ã€[Events](../html/events.mdx) ãƒšãƒ¼ã‚¸ã®[Using `Closure` ã‚»ã‚¯ã‚·ãƒ§ãƒ³](../html/events.mdx#using-closure-verbose) ã«ã‚ã‚Šã¾ã™ã€‚

_[`Closure` ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://rustwasm.github.io/wasm-bindgen/api/wasm_bindgen/closure/struct.Closure.html)._

## [`js-sys`](https://crates.io/crates/js-sys)

`js-sys` ã‚¯ãƒ¬ãƒ¼ãƒˆã¯ã€JavaScript ã®æ¨™æº–çµ„ã¿è¾¼ã¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°/ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’æä¾›ã—ã¾ã™ã€‚ã“ã‚Œã«ã¯ã€ãã‚Œã‚‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå«ã¾ã‚Œã¾ã™ã€‚

ã“ã‚Œã¯ Web API ã‚’å«ã¿ã¾ã›ã‚“ã€‚Web API ã¯ [`web-sys`](./web-sys.mdx) ã®å½¹å‰²ã§ã™ï¼

_[`js-sys` ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://rustwasm.github.io/wasm-bindgen/api/js_sys/index.html)._

## [`wasm-bindgen-futures`](https://crates.io/crates/wasm-bindgen-futures)

`wasm-bindgen-futures` ã‚¯ãƒ¬ãƒ¼ãƒˆã¯ã€JavaScript ã® Promise å‹ã‚’ Rust ã® [`Future`](https://doc.rust-lang.org/stable/std/future/trait.Future.html) ã¨ã—ã¦æ‰±ã†ãŸã‚ã®ãƒ–ãƒªãƒƒã‚¸ã‚’æä¾›ã—ã€Rust ã® Future ã‚’ JavaScript ã® Promise ã«å¤‰æ›ã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’å«ã¿ã¾ã™ã€‚Rustï¼ˆwasmï¼‰ã§éåŒæœŸã¾ãŸã¯ä»–ã®ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ä½œæ¥­ã‚’å‡¦ç†ã™ã‚‹éš›ã«å½¹ç«‹ã¡ã€JavaScript ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚„ JavaScript I/O ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã¨å¯¾è©±ã™ã‚‹èƒ½åŠ›ã‚’æä¾›ã—ã¾ã™ã€‚

ç¾åœ¨ã€ã“ã®ã‚¯ãƒ¬ãƒ¼ãƒˆã«ã¯3ã¤ã®ä¸»è¦ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ï¼š

1. [`JsFuture`](https://rustwasm.github.io/wasm-bindgen/api/wasm_bindgen_futures/struct.JsFuture.html) -
   [`Promise`](https://rustwasm.github.io/wasm-bindgen/api/js_sys/struct.Promise.html) ã‚’ä½¿ç”¨ã—ã¦æ§‹ç¯‰ã•ã‚ŒãŸå‹ã§ã€`Future<Output=Result<JsValue, JsValue>>` ã¨ã—ã¦ä½¿ç”¨ã§ãã¾ã™ã€‚`Promise` ãŒè§£æ±ºã•ã‚Œã‚‹ã¨ã€ã“ã® `Future` ã¯ `Ok` ã«è§£æ±ºã•ã‚Œã€`Promise` ãŒæ‹’å¦ã•ã‚Œã‚‹ã¨ `Err` ã«è§£æ±ºã•ã‚Œã€ãã‚Œãã‚Œ `Promise` ã®è§£æ±ºã¾ãŸã¯æ‹’å¦ã®å€¤ã‚’å«ã¿ã¾ã™ã€‚

2. [`future_to_promise`](https://rustwasm.github.io/wasm-bindgen/api/wasm_bindgen_futures/fn.future_to_promise.html) -
   Rust ã® `Future<Output=Result<JsValue, JsValue>>` ã‚’ JavaScript ã® `Promise` ã«å¤‰æ›ã—ã¾ã™ã€‚Future ã®çµæœã¯ã€JavaScript å†…ã®è§£æ±ºã¾ãŸã¯æ‹’å¦ã•ã‚ŒãŸ `Promise` ã«å¤‰æ›ã•ã‚Œã¾ã™ã€‚

3. [`spawn_local`](https://rustwasm.github.io/wasm-bindgen/api/wasm_bindgen_futures/fn.spawn_local.html) -
   ç¾åœ¨ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã§ `Future<Output = ()>` ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã“ã‚Œã¯ã€Rust å†…ã§ Future ã‚’å®Ÿè¡Œã™ã‚‹æœ€è‰¯ã®æ–¹æ³•ã§ã‚ã‚Šã€JavaScript ã«é€ä¿¡ã™ã‚‹ã®ã§ã¯ãªãã€Rust å†…ã§å®Ÿè¡Œã—ã¾ã™ã€‚

_[`wasm-bindgen-futures` ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://rustwasm.github.io/wasm-bindgen/api/wasm_bindgen_futures/index.html)._

### [`spawn_local`](https://rustwasm.github.io/wasm-bindgen/api/wasm_bindgen_futures/fn.spawn_local.html)

`spawn_local` ã¯ã€éåŒæœŸ API ã‚’ä½¿ç”¨ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹éš›ã«ã€Yew ã§ `wasm-bindgen-futures` ã‚¯ãƒ¬ãƒ¼ãƒˆã®æœ€ã‚‚ä¸€èˆ¬çš„ã«ä½¿ç”¨ã•ã‚Œã‚‹éƒ¨åˆ†ã§ã™ã€‚

```rust ,no_run
use web_sys::console;
use wasm_bindgen_futures::spawn_local;

async fn my_async_fn() -> String { String::from("Hello") }

spawn_local(async {
    let mut string = my_async_fn().await;
    string.push_str(", world!");
    // "Hello, world!" ã‚’å‡ºåŠ›ã—ã¾ã™
    console::log_1(&string.into());
});
```

Yew ã¯ã„ãã¤ã‹ã® API ã« futures ã®ã‚µãƒãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¦ãŠã‚Šã€ç‰¹ã« `async` ãƒ–ãƒ­ãƒƒã‚¯ã‚’å—ã‘å…¥ã‚Œã‚‹ `callback_future` ã‚’ä½œæˆã§ãã‚‹ã“ã¨ãŒæ³¨ç›®ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯å†…éƒ¨çš„ã« `spawn_local` ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

_[`spawn_local` ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://rustwasm.github.io/wasm-bindgen/api/wasm_bindgen_futures/fn.spawn_local.html)._
