use criterion::measurement::Measurement;
use criterion::{Bencher, Criterion};
use yew::virtual_dom::Key;

/// Generate keys.
fn generate_keys<T>(inputs: &[T]) -> Vec<Key>
where
    T: Copy,
    Key: From<T>,
{
    let mut output = Vec::with_capacity(inputs.len());

    for input in inputs {
        output.push(Key::from(*input));
    }

    output
}

fn criterion_benchmark(c: &mut Criterion) {
    c.bench_function("bench_u64_key", bench_u64_key);
    c.bench_function("bench_u128_key", bench_u128_key);
    c.bench_function("bench_string_key", bench_string_key);
}

fn bench_u64_key<M>(b: &mut Bencher<'_, M>)
where
    M: Measurement,
{
    b.iter(|| generate_keys(&NUMBERS[..]));
}

fn bench_u128_key<M>(b: &mut Bencher<'_, M>)
where
    M: Measurement,
{
    let mut inputs = Vec::new();

    for (n, n1) in NUMBERS
        .iter()
        .copied()
        .zip(NUMBERS.iter().cycle().skip(32).copied())
    {
        inputs.push(n as u128 + ((n1 as u128) << 64));
    }

    b.iter(|| generate_keys(&NUMBERS[..]));
}

fn bench_string_key<M>(b: &mut Bencher<'_, M>)
where
    M: Measurement,
{
    let mut strings = Vec::new();

    for n in NUMBERS {
        strings.push(format!("index-with-a-bit-of-content-{}", n));
    }

    let mut inputs = Vec::new();

    for string in &strings {
        inputs.push(string.as_str());
    }

    b.iter(|| generate_keys(&inputs[..]));
}

criterion::criterion_group!(benches, criterion_benchmark);
criterion::criterion_main!(benches);

const NUMBERS: [u64; 128] = [
    6776162341390364014,
    3744033845937679988,
    10924778726064514273,
    16900272778048652565,
    14961124101047253044,
    10207844975056844316,
    8138990578251542959,
    7654361573606114200,
    5353963487873101698,
    12711609619287818145,
    11005086854909881460,
    11755446778275429254,
    17434402818806853051,
    12377747583896053303,
    5942271123820048934,
    17439925968050364996,
    8789968836467371022,
    10133352610171102006,
    11062290432516262833,
    5385858336383075551,
    3688855674059020352,
    1402468866452954607,
    17086859656727809506,
    17191332552433742407,
    13563478532197796524,
    14928204602071166327,
    3045643362504266265,
    2309163947749124944,
    10418047901435129750,
    14440651148185950772,
    6147179561179526476,
    11970285154217672206,
    17720938054271856211,
    6714486673120460390,
    16507565965848611346,
    10415695235615100962,
    4175896063718673938,
    11103661799901215570,
    5361844646653352775,
    10127274554046027640,
    261747772238917703,
    12364603230516074627,
    18413808055592264554,
    12600498713015469429,
    8374649997533472909,
    10810144246689324289,
    13655330473091212686,
    17119656799244873759,
    17619424988990381311,
    17668650645021761608,
    14859722209235089093,
    12263054273104079887,
    16184566776618234442,
    6395276348715678267,
    15954800101380110399,
    2223082548455160208,
    9661929276540471676,
    6944834875654573354,
    2481567131331348127,
    6272594912040575562,
    3444560915621459669,
    17290783871708415173,
    2997386345441067002,
    5667072301453313296,
    8693800052856035484,
    14320982671299240617,
    16095757899704696482,
    6002562893171071980,
    5158201862232084721,
    897964828415622908,
    164331554772843714,
    15035220970230753403,
    548146536720856188,
    6432484115396459331,
    8242092532947550744,
    5707312674444794103,
    1802601428304913577,
    2857836330948952304,
    7094749668674007735,
    14715046317354412378,
    18370824556479495521,
    4285618418009988554,
    13400435926746662079,
    13221485912712353345,
    10850198973508133079,
    9588412360678520037,
    8690837695041016427,
    8404975663194442995,
    14802890626254569524,
    4113193877193263617,
    6139508658090798730,
    8260463106355245907,
    3785085022952973108,
    5323018228887835742,
    436328554607828834,
    17610000419696419458,
    13020821453058997642,
    18383506927780146102,
    12144859392662111260,
    11871019343496577812,
    3981821694988831393,
    1335057699092659138,
    1613842255499192059,
    8930888823231795002,
    3917065235665359259,
    1882021886457605767,
    2152153881371045758,
    12627912092669695798,
    660028334606095333,
    7880674013782264625,
    3684416053821049068,
    8182849882822559052,
    9222865455922907773,
    12761586326192237232,
    593667162685655164,
    4908197048120707542,
    14087976067454783577,
    17419718010068242733,
    10948236322264861667,
    3767523575632039661,
    9865521828379497796,
    1436491650651589068,
    17069343034716500775,
    15796649925065390874,
    11315136693718657979,
    13480720017888061002,
    16109633691496538691,
    5411808346528248444,
];
